/*!
 * Torro Forms Version 1.0.3 (https://torro-forms.com)
 * Licensed under GNU General Public License v2 (or later) (http://www.gnu.org/licenses/gpl-2.0.html)
 */
!function(e,t,n,i){"use strict";function o(t,n,i){return n&&n.length?u[t]&&u[t][n]?void i(u[t][n]):void e.api.init().done(function(){new e.api.models.ApiActionConnection({action:t,connection:n}).fetch({data:{context:"view"},context:this,success:function(e){u[t]||(u[t]={}),u[t][n]=e.attributes,i(e.attributes)},error:function(){console.error(l.couldNotLoadData)}})}).fail(function(){console.error(l.couldNotLoadData)}):void i(void 0)}function r(e,t,n){var i;if(!e||!t||!t.length)return void n(void 0);for(i=0;i<e.routes.length;i++)if(e.routes[i].slug===t)return void n(e.routes[i]);n(void 0)}function a(e){var i=n(".plugin-lib-repeatable-group-"+e+"__integrations-wrap");i.length&&n(document).ready(function(){function i(t,i,r){var a=i.name.match(/\[(\d+)\]$/),u=c.get("items");a&&u&&(a=parseInt(a[1],10),u[a]&&o(e,r.connection,function(e){var t={},i=[],o=n("#"+u[a].fields.route.id),c=o;if(t[""]=l.selectARoute,i.push({id:"",text:l.selectARoute}),e&&e.routes.forEach(function(e){t[e.slug]=e.title,i.push({id:e.slug,text:e.title})}),u[a].fields.route.choices=t,o.empty().select2({data:i}),r.route){if(!t[r.route])return void o.val("").trigger("change");r.route!==c&&o.val(r.route).trigger("change")}}))}function a(i,a,c){o(e,c.connection,function(e){r(e,c.route,function(e){var i,o,r={},c=!1,l=n("#"+a.fields.mappings.wrapAttrs.id);e&&(e.fields.forEach(function(e){e.readonly||"array"!==e.type&&(r[e.slug]=e)}),r&&(c=!0)),a.fields.mappings.params=r,a.fields.mappings.display=c,l.data("torroView")&&s[l.data("torroView")]?(o=s[l.data("torroView")],i=o.model):(i=new t.Field(a.fields.mappings),o=new t.FieldView.FieldmappingsFieldView({model:i}),s[o.cid]=o,l.data("torroView",o.cid)),o.applyParams(i,r),o.applyDisplay(i,c)})})}var c=t.FieldManager.instances[d].get(d+"_"+e.replace("_","-")+"--integrations");c.on("changeItemValue:connection",function(e,t,n){i(e,t,n)}),c.on("changeItemValue:route",function(e,t,n){a(e,t,n)}),c.get("items").forEach(function(e){var t=n("#"+e.fields.connection.id),o=t.val();o&&o.length&&(t.trigger("change"),i(c,e,e.currentValue))})})}var c=i.actions,l=i.i18n,u={},d=n("#torro_module_actions-field-manager-instance"),s={};t.FieldView.FieldmappingsFieldView=t.FieldView.extend({getEvents:function(){return{}},applyParams:function(){this.renderContent()}}),c.length&&d.length&&(d=d.val(),c.forEach(a))}(window.torro,window.pluginLibFieldsAPI,window.jQuery,window.torroAPIActionsData||{});